extracted from https://github.com/esp8266/Arduino/tree/master/cores/esp8266
code by Ivan Grokhotkov
